@page "/"
@attribute [Authorize]
@inject ITrendService TrendService

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudText Typo="Typo.h3" GutterBottom="true">TrendifyAI</MudText>
    <MudTextField @bind-Value="niche" Label="Enter Niche" Variant="Variant.Outlined" Margin="Margin.Dense" Immediate="true" />
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-2" OnClick="ScanTrends" Disabled="@string.IsNullOrEmpty(niche)">Scan Trends</MudButton>

    @if (isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="mt-4" />
    }
    @if (errorMessage != null)
    {
        <MudAlert Severity="Severity.Error" Class="mt-4">@errorMessage</MudAlert>
    }
    else if (trends != null)
    {
        @if (trends.Any())
        {
            <MudGrid Class="mt-4">
                @foreach (var trend in trends)
                {
                    <MudItem xs="12" sm="6" md="4">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">@trend.Trend</MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudText><strong>Why:</strong> @trend.Context</MudText>
                                <MudText><strong>Idea:</strong> @trend.ActionableIdea</MudText>
                                <MudText><strong>Post:</strong> @trend.PreDraftedContent</MudText>
                                <MudText><strong>Reach:</strong> @trend.EstimatedReach mentions</MudText>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }
            </MudGrid>
        }
        else
        {
            <MudText Class="mt-4" Typo="Typo.body1" Color="Color.Secondary">No trends found for "@niche"</MudText>
        }
    }
</MudContainer>

@code {
    private string niche = "";
    private List<TrendViewModel> trends;
    private bool isLoading = false;
    private string errorMessage;

    private async Task ScanTrends()
    {
        isLoading = true;
        errorMessage = null;
        trends = null;
        try
        {
            trends = await TrendService.GetTrends(niche);
        }
        catch (Exception ex)
        {
            errorMessage = "Failed to load trends: " + ex.Message;
        }
        finally
        {
            isLoading = false;
        }
    }
}