@page "/"
@attribute [Authorize]
@inject ITrendService TrendService

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudText Typo="Typo.h3" GutterBottom="true">TrendifyAI</MudText>
    <MudTextField @bind-Value="niche" Label="Enter Niche" Variant="Variant.Outlined" Margin="Margin.Dense" Immediate="true" />
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-2" OnClick="ScanTrends" Disabled="@string.IsNullOrEmpty(niche)">Scan Trends</MudButton>

    @if (isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="mt-4" />
    }
    @if (errorMessage != null)
    {
        <MudAlert Severity="Severity.Error" Class="mt-4">@errorMessage</MudAlert>
    }
    else if (trends != null)
    {
        @if (trends.Any())
        {
            


            <MudGrid Class="mt-4">
                @foreach (var trend in trends)
                {
                    <MudItem xs="12" sm="6" md="4">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">@trend.Trend</MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudExpansionPanels>
                                    <MudExpansionPanel Text="Why">
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">The hot scoop behind the trend—what’s driving the buzz right now. We dig into the chatter so you know why it matters.</MudText>
                                        <MudText>@trend.Context</MudText>
                                    </MudExpansionPanel>
                                    <MudExpansionPanel Text="Idea">
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">Your next big move—a killer strategy to jump on this trend and grow your audience, cooked up just for you.</MudText>
                                        <MudText>@trend.ActionableIdea</MudText>
                                    </MudExpansionPanel>
                                    <MudExpansionPanel Text="Post">
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">A ready-to-roll post that rides the wave—copy, paste, and watch the likes roll in. We write it, you shine.</MudText>
                                        <MudText>@trend.PreDraftedContent</MudText>
                                    </MudExpansionPanel>
                                    <MudExpansionPanel Text="Reach">
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">The crowd this trend’s hitting—how many eyes could see your move. Bigger reach, bigger wins.</MudText>
                                        <MudText>@trend.EstimatedReach mentions</MudText>
                                    </MudExpansionPanel>
                                </MudExpansionPanels>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                }
            </MudGrid>
        }
        else
        {
            <MudText Class="mt-4" Typo="Typo.body1" Color="Color.Secondary">No trends found for "@niche"</MudText>
        }
    }
</MudContainer>

@code {
    private string niche = "";
    private List<TrendViewModel> trends;
    private bool isLoading = false;
    private string errorMessage;

    private async Task ScanTrends()
    {
        isLoading = true;
        errorMessage = null;
        trends = null;
        try
        {
            trends = await TrendService.GetTrends(niche);
        }
        catch (Exception ex)
        {
            errorMessage = "Failed to load trends: " + ex.Message;
        }
        finally
        {
            isLoading = false;
        }
    }
}